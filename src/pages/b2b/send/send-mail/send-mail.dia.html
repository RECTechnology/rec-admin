<header-nav></header-nav>
<sidemenu></sidemenu>

<div class="page mailing" [ngClass]="{'collapsed': !controls.sidemenuVisible}">
    <div class="padd-x20" style="width: 100%">
        <mat-card style="margin-bottom: 10px">
            <div class="center v">
                <button mat-icon-button routerLink="/rec/mailing" class="icon-btn-small" style="margin-right: 10px">
                    <div class="center h v">
                        <i class="fa fa-angle-left"></i>
                    </div>
                </button>
                <p class="col-blue small-text">
                    {{(isEdit ? 'EDIT_MAIL': 'CREATE_MAIL')|translate}}
                </p>
            </div>
        </mat-card>
        <div class="row" style="margin: 0; padding: 0">
            <mat-card class="col-lg-8" style="margin-bottom: 10px; margin-top: 10px">
                <!-- From -->
                <div class="group-row-left bordered-bottom" style="padding-bottom: 10px!important">
                    <p class="small-text">
                        {{'ALL_MAIL_FROM'|translate}} <a href="mailto:no-reply@email.rec.barcelona"
                            class="col-info">no-reply@email.rec.barcelona</a></p>
                </div>

                <!-- Subject -->
                <div class="group-row-left center v space-between" style="padding-bottom: 10px; padding-top: 10px">
                    <div class="group-row-left" style="width: 90%">
                        <p class="small-text" style="margin-right: 10px!important">{{'Subject'|translate}}</p>
                        <input matInput type="text" [disabled]="readonly"
                            style="width: 100%; font-size: 12px;padding:3px 6px; border: 1px solid #ddd; border-radius: 2px"
                            placeholder="{{'Subject'|translate}}" [(ngModel)]="mail.subject">
                    </div>
                </div>

                <!-- Content -->
                <div style="width: 100%;" class="group-col-left">
                    <quill-editor [disabled]="readonly" style="width: 100%;" [ngModel]="mail.content" format="html"
                        [styles]="{height: '200px', width: '100%'}" (onFocus)="focus($event)"
                        (onEditorChanged)="changedEditor($event)" (onBlur)="blur($event)"
                        (onEditorCreated)="created($event)">
                    </quill-editor>
                </div>
            </mat-card>
            <div class="col-lg-4" style="margin-bottom: 10px;width: 100%; margin-top: 10px;">
                <mat-card style="width: 100%; height: 100%;">
                    <create-delivery [id]="id" [disabled]="readonly" [selectedAccounts]="deliveries" (update)="update()">
                    </create-delivery>
                </mat-card>
            </div>
        </div>
        <mat-card style="margin-bottom: 10px">
            <validation-errors [errors]="validationErrors" *ngIf="validationErrors.length > 0"
                style="border-bottom: 1px solid #ddd!important; width: 100%" [validationName]="validationErrorName">
            </validation-errors>

            <button mat-flat-button color="primary" (click)="sendNormal()"
                [disabled]="readonly || mail.status != 'created'"
                style="border-top-right-radius: 0; border-bottom-right-radius: 0">{{'Send'|translate}}</button>
            <button mat-flat-button [disabled]="readonly || mail.status != 'created'" color="primary"
                style="border-top-left-radius: 0; border-bottom-left-radius: 0" [matMenuTriggerFor]="menusend"
                aria-label="Example icon-button with a menu">
                <i class="fa fa-caret-down"></i>
            </button>
            <mat-menu #menusend="matMenu">
                <button mat-menu-item (click)="sendScheduled()">
                    <i class="fa fa-paper-plane"></i>
                    <span>{{'SEND_SCHEDULED'|translate}}</span>
                </button>
            </mat-menu>

            <button color="primary" *ngIf="isEdit" [disabled]="isSaveDisabled() || loading || readonly"
                (click)="saveMail()" mat-raised-button style="margin-right: 10px;margin-left: 15px"
                matTooltip="{{'SAVE'|translate}}">
                <i class="fa fa-save" style="margin-right: 8px"></i> {{'SAVE'|translate}}
            </button>

            <button color="primary" *ngIf="!isEdit" (click)="createMail()"
                [disabled]="isSaveDisabled() || loading || readonly" mat-raised-button
                style="margin-right: 10px;margin-left: 15px" matTooltip="{{'Create'|translate}}">
                <i class="fa fa-save" style="margin-right: 8px"></i> {{'Create'|translate}}
            </button>

            <button mat-button matTooltip="{{'ATTACH'|translate}}" [matMenuTriggerFor]="menu" [disabled]="readonly">
                <span class="center v">
                    <i class="fa fa-paperclip" style="margin-right: 10px"></i>
                    <p>{{'ATTACH_FILES'|translate}}</p>
                </span>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="addAttachment('b2b_report', 'b2b_report.pdf')">Clients/Providers
                    PDF</button>
                <button mat-menu-item (click)="addLink = true">Link</button>
                <button mat-menu-item (click)="selectFile()" disabled>Upload</button>
            </mat-menu>

            <mat-chip-list style="display: inline-block;margin-left: 10px">
                <mat-chip *ngFor="let item of attachments">
                    <div class="center h v" style="height: 100%">
                        {{item.name}}
                        <button mat-icon-button color="primary" (click)="removeAttachment(item.name)">
                            <i class="fa fa-times" style="margin-left: 10px"></i>
                        </button>
                    </div>
                </mat-chip>
            </mat-chip-list>

            <div *ngIf="addLink" style="padding-top: 20px; border-top: 1px solid #ddd;">
                <input matInput type="text" [disabled]="readonly"
                    style="width: 50%; font-size: 12px;padding:3px 6px; border: 1px solid #ddd; border-radius: 2px"
                    placeholder="Name of file (defaults to link file name)" [(ngModel)]="linkName">

                <input matInput type="text" [disabled]="readonly"
                    style="width: 50%; font-size: 12px;padding:3px 6px; border: 1px solid #ddd; border-radius: 2px"
                    placeholder="http://" [(ngModel)]="linkAttachment">
                <div>
                    <button mat-button (click)="addLink = false">Cancel</button>
                    <button mat-button (click)="addLinkAttachment()">Add</button>
                </div>
            </div>
        </mat-card>
    </div>
</div>