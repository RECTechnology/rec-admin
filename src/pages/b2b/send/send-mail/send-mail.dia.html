<header-nav></header-nav>
<sidemenu></sidemenu>

<div class="page mailing" [ngClass]="{'collapsed': !controls.sidemenuVisible}">
    <div class="padd-x20" style="width: 100%">
        <mat-card style="margin-bottom: 10px">
            <div class="center v">
                <button mat-icon-button routerLink="/rec/mailing" class="icon-btn-small" style="margin-right: 10px">
                    <div class="center h v">
                        <i class="fa fa-angle-left"></i>
                    </div>
                </button>
                <p class="col-blue small-text">
                    {{(isEdit ? 'EDIT_MAIL': 'CREATE_MAIL')|translate}}
                </p>
            </div>
        </mat-card>
        <mat-card style="margin-bottom: 10px; width: 100%; margin-top: 10px">
            <!-- From -->
            <div class="group-row-left bordered-bottom" style="padding-bottom: 10px!important">
                <p class="small-text">
                    {{'ALL_MAIL_FROM'|translate}} <a href="mailto:no-reply@email.rec.barcelona"
                        class="col-info">no-reply@email.rec.barcelona</a></p>
            </div>

            <!-- Subject -->
            <div class="group-row-left center v space-between" style="padding-bottom: 10px; padding-top: 10px">
                <div class="group-row-left" style="width: 90%">
                    <p class="small-text" style="margin-right: 10px!important">{{'Subject'|translate}}</p>
                    <input matInput type="text"
                        style="width: 100%; font-size: 12px;padding:3px 6px; border: 1px solid #ddd; border-radius: 2px"
                        placeholder="{{'Subject'|translate}}" [(ngModel)]="mail.subject">
                </div>
            </div>

            <!-- Accountws -->
            <div class="group-row-left center v space-between" style="padding-bottom: 10px; padding-top: 10px">
                <div class="group-row-left" style="width: 90%">
                    <p class="small-text" style="margin-right: 10px!important">{{'To'|translate}}</p>
                    <!-- <div matInput type="text"
                        style="width: 100%; font-size: 12px;padding:3px 6px; border: 1px solid #ddd; border-radius: 2px"
                        placeholder="{{'Subject'|translate}}" [(ngModel)]="mail.subject"> -->
                    <mat-chip-list aria-label="Fish selection">
                        <mat-chip selected color="{{getStatusColor(item.status)}}" *ngFor="let item of sortedData">
                            <div class="center h v" style="height: 100%">
                                {{item.account.name}} ({{item.account.id}})
                                <i class="fa fa-times" (click)="deleteAccount(item)" style="margin-left: 10px"></i>
                            </div>
                        </mat-chip>
                        <mat-chip *ngIf="moreThan5" (click)="showAll()">
                            <div class="center h v" style="height: 100%">
                                ... ({{total}} items)
                            </div>
                        </mat-chip>
                        <mat-chip (click)="createDelivery()" color="primary" selected>
                            <div class="center h v" style="height: 100%">
                                <i class="fa fa-plus"></i>
                            </div>
                        </mat-chip>
                    </mat-chip-list>
                </div>
            </div>

            <!-- Content -->
            <div style="width: 100%;" class="group-col-left">
                <quill-editor style="width: 100%;" [ngModel]="mail.content" format="html"
                    [styles]="{height: '200px', width: '100%'}" (onFocus)="focus($event)"
                    (onEditorChanged)="changedEditor($event)" (onBlur)="blur($event)"
                    (onEditorCreated)="created($event)">
                </quill-editor>
            </div>
        </mat-card>
        <mat-card style="margin-bottom: 10px">

            <!-- <div *ngIf="sendScheduled" class="group-row-left center v"
                style="min-width: 30%; width: auto;margin-left: 10px">
                <p class="small-text no-marg" style="margin-right: 8px!important; width: auto">
                    {{'SEND_SCHEDULED'|translate}}</p>
                <input type="datetime-local" [(ngModel)]="mail.scheduled_at"
                    style="border-radius: 2px;border: 1px solid #ddd;font-size: 12px">

                <button mat-icon-button (click)="sendScheduled = false">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div *ngIf="!sendScheduled" class="group-row-left">
                <button mat-raised-button color="primary" style="margin: 0 10px;"
                    (click)="sendScheduled = !sendScheduled">{{'SEND_SCHEDULED'|translate}}</button>
                <button mat-raised-button color="primary" style="margin-right: 10px">{{'SEND_NOW'|translate}}</button>
            </div> -->

            <button mat-flat-button color="primary"
                style="border-top-right-radius: 0; border-bottom-right-radius: 0">{{'Send'|translate}}</button>
            <button mat-flat-button color="primary" style="border-top-left-radius: 0; border-bottom-left-radius: 0"
                [matMenuTriggerFor]="menusend" aria-label="Example icon-button with a menu">
                <i class="fa fa-caret-down"></i>
            </button>
            <mat-menu #menusend="matMenu">
                <button mat-menu-item>
                    <i class="fa fa-paper-plane"></i>
                    <span>{{'SEND_SCHEDULED'|translate}}</span>
                </button>
            </mat-menu>

            <button color="primary" *ngIf="isEdit" [disabled]="isSaveDisabled() || loading" (click)="updateMail()"
                mat-raised-button style="margin-right: 10px;margin-left: 15px" matTooltip="{{'SAVE'|translate}}">
                <i class="fa fa-save" style="margin-right: 8px"></i> {{'SAVE'|translate}}
            </button>

            <button color="primary" *ngIf="!isEdit" (click)="createMail()" [disabled]="isSaveDisabled() || loading"
                mat-raised-button style="margin-right: 10px" matTooltip="{{'Create'|translate}}">
                <i class="fa fa-save" style="margin-right: 8px"></i> {{'Create'|translate}}
            </button>

            <!-- <button color="primary" (click)="createDelivery()" mat-raised-button [disabled]="loading || !isEdit"
                style="margin-right: 10px"
                matTooltip="{{(!isEdit ? 'Please, save before creating a delivery': 'CREATE_DELIVERY')|translate}}">
                <i class="fa fa-paper-plane" style="margin-right: 8px"></i> {{'CREATE_DELIVERY'|translate}}
            </button> -->
            <button mat-button matTooltip="{{'ATTACH'|translate}}" [matMenuTriggerFor]="menu">
                <span class="center v">
                    <i class="fa fa-paperclip" style="margin-right: 10px"></i>
                    <p>{{'ATTACH_FILES'|translate}}</p>
                </span>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item disabled>Clients/Providers PDF</button>
                <button mat-menu-item (click)="selectFile()">Other</button>
            </mat-menu>
        </mat-card>
        <!-- <mat-card style="padding: 0">
            <tl-header title="DELIVERIES" [(query)]="query" (onSearch)="search()"></tl-header>
            <tl-subheader style="position: relative">
                <div class="abs-center-right small-text">
                    {{'Showing'|translate}}: {{data.length}} <b>of</b> {{total}}
                </div>
            </tl-subheader>
            <tl-table [loading]="loading" [sort]="true" (onSort)="sortData($event)" [headers]="headers"
                [data]="sortedData" noItemsMessage="There are no deliveries yet" [limit]="limit" [total]="total"
                (onChangePage)="changedPage($event)">
            </tl-table>
        </mat-card> -->
    </div>
</div>